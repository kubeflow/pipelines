[
    {
        "apiVersion": "v1",
        "kind": "ConfigMap",
        "metadata": {
            "name": "metadata-grpc-configmap",
            "namespace": "{{namespace}}"
        },
        "data": {
            "METADATA_GRPC_SERVICE_HOST":
                "metadata-grpc-service.kubeflow",
            "METADATA_GRPC_SERVICE_PORT": "8080"
        }
    },
    {
        "apiVersion": "apps/v1",
        "kind": "Deployment",
        "metadata": {
            "labels": {
                "app": "ml-pipeline-visualizationserver"
            },
            "name": "ml-pipeline-visualizationserver",
            "namespace": "{{namespace}}"
        },
        "spec": {
            "selector": {
                "matchLabels": {
                    "app": "ml-pipeline-visualizationserver"
                }
            },
            "template": {
                "metadata": {
                    "labels": {
                        "app": "ml-pipeline-visualizationserver"
                    },
                    "annotations": {{istio_sidecar_annotation}}
                },
                "spec": {
                    "containers": [{
                        "image": "{{visualization_server_image}}:{{visualization_server_tag}}",
                        "imagePullPolicy":
                            "IfNotPresent",
                        "name":
                            "ml-pipeline-visualizationserver",
                        "ports": [{
                            "containerPort": 8888
                        }],
                        "resources": {
                            "requests": {
                                "cpu": "50m",
                                "memory": "200Mi"
                            },
                            "limits": {
                                "cpu": "500m",
                                "memory": "1Gi"
                            }
                        }
                    }],
                    "serviceAccountName":
                        "default-editor"
                }
            }
        }
    },
    {
        "apiVersion": "networking.istio.io/v1alpha3",
        "kind": "DestinationRule",
        "metadata": {
            "name": "ml-pipeline-visualizationserver",
            "namespace": "{{namespace}}"
        },
        "spec": {
            "host": "ml-pipeline-visualizationserver",
            "trafficPolicy": {
                "tls": {
                    "mode": "ISTIO_MUTUAL"
                }
            }
        }
    },
    {
        "apiVersion": "security.istio.io/v1beta1",
        "kind": "AuthorizationPolicy",
        "metadata": {
            "name": "ml-pipeline-visualizationserver",
            "namespace": "{{namespace}}"
        },
        "spec": {
            "selector": {
                "matchLabels": {
                    "app": "ml-pipeline-visualizationserver"
                }
            },
            "rules": [{
                "from": [{
                    "source": {
                        "principals": ["cluster.local/ns/kubeflow/sa/ml-pipeline"]
                    }
                }]
            }]
        }
    },
    {
        "apiVersion": "v1",
        "kind": "Service",
        "metadata": {
            "name": "ml-pipeline-visualizationserver",
            "namespace": "{{namespace}}"
        },
        "spec": {
            "ports": [{
                "name": "http",
                "port": 8888,
                "protocol": "TCP",
                "targetPort": 8888
            }],
            "selector": {
                "app": "ml-pipeline-visualizationserver"
            }
        }
    },
    {
        "apiVersion": "apps/v1",
        "kind": "Deployment",
        "metadata": {
            "labels": {
                "app": "ml-pipeline-ui-artifact"
            },
            "name": "ml-pipeline-ui-artifact",
            "namespace": "{{namespace}}"
        },
        "spec": {
            "selector": {
                "matchLabels": {
                    "app": "ml-pipeline-ui-artifact"
                }
            },
            "template": {
                "metadata": {
                    "labels": {
                        "app": "ml-pipeline-ui-artifact"
                    },
                    "annotations": {{istio_sidecar_annotation}}
                },
                "spec": {
                    "containers": [{
                        "name":
                            "ml-pipeline-ui-artifact",
                        "image": "{{frontend_image}}:{{frontend_tag}}",
                        "imagePullPolicy":
                            "IfNotPresent",
                        "ports": [{
                            "containerPort": 3000
                        }],
                        "env": [
                            {
                                "name": "MINIO_ACCESS_KEY",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "accesskey",
                                        "name": "mlpipeline-minio-artifact"
                                    }
                                }
                            },
                            {
                                "name": "MINIO_SECRET_KEY",
                                "valueFrom": {
                                    "secretKeyRef": {
                                        "key": "secretkey",
                                        "name": "mlpipeline-minio-artifact"
                                    }
                                }
                            }
                        ],
                        "resources": {
                            "requests": {
                                "cpu": "10m",
                                "memory": "70Mi"
                            },
                            "limits": {
                                "cpu": "100m",
                                "memory": "500Mi"
                            }
                        }
                    }],
                    "serviceAccountName":
                        "default-editor"
                }
            }
        }
    },
    {
        "apiVersion": "v1",
        "kind": "Service",
        "metadata": {
            "name": "ml-pipeline-ui-artifact",
            "namespace": "{{namespace}}",
            "labels": {
                "app": "ml-pipeline-ui-artifact"
            }
        },
        "spec": {
            "ports": [{
                "name":
                    "http",
                "port": 80,
                "protocol": "TCP",
                "targetPort": 3000
            }],
            "selector": {
                "app": "ml-pipeline-ui-artifact"
            }
        }
    },
    {
        "apiVersion": "v1",
        "kind": "Secret",
        "metadata": {
            "name": "mlpipeline-minio-artifact",
            "namespace": "{{namespace}}"
        },
        "data": {
            "accesskey": "{{minio_access_key}}",
            "secretkey": "{{minio_secret_key}}"
        }
    }
]