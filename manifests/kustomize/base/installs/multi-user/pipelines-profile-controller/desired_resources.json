{
    "base": [
        {
            "apiVersion": "v1",
            "kind": "ConfigMap",
            "metadata": {
                "name": "kfp-launcher",
                "namespace": "${namespace}"
            },
            "data": {
                "defaultPipelineRoot": "minio://mlpipeline/private-artifacts/${namespace}/v2/artifacts",
                "clusterDomain": "${cluster_domain}"
            }
        },
        {
            "apiVersion": "v1",
            "kind": "ConfigMap",
            "metadata": {
                "name": "metadata-grpc-configmap",
                "namespace": "${namespace}"
            },
            "data": {
                "METADATA_GRPC_SERVICE_HOST": "metadata-grpc-service.kubeflow",
                "METADATA_GRPC_SERVICE_PORT": "8080"
            }
        },
        {
            "apiVersion": "v1",
            "kind": "ConfigMap",
            "metadata": {
                "name": "artifact-repositories",
                "namespace": "${namespace}",
                "annotations": {
                    "workflows.argoproj.io/default-artifact-repository": "default-namespaced"
                }
            },
            "data": {
                "default-namespaced": {
                    "archiveLogs": true,
                    "s3": {
                        "endpoint": "${object_store_host}.kubeflow${normalized_cluster_domain}:9000",
                        "bucket": "mlpipeline",
                        "keyFormat": "private-artifacts/${namespace}/{{workflow.name}}/{{workflow.creationTimestamp.Y}}/{{workflow.creationTimestamp.m}}/{{workflow.creationTimestamp.d}}/{{pod.name}}",
                        "insecure": true,
                        "accessKeySecret": {
                            "name": "mlpipeline-minio-artifact",
                            "key": "accesskey"
                        },
                        "secretKeySecret": {
                            "name": "mlpipeline-minio-artifact",
                            "key": "secretkey"
                        }
                    }
                }
            }
        }
    ],
    "artifact_proxy": [
        {
            "apiVersion": "apps/v1",
            "kind": "Deployment",
            "metadata": {
                "labels": {
                    "app": "ml-pipeline-ui-artifact"
                },
                "name": "ml-pipeline-ui-artifact",
                "namespace": "${namespace}"
            },
            "spec": {
                "selector": {
                    "matchLabels": {
                        "app": "ml-pipeline-ui-artifact"
                    }
                },
                "template": {
                    "metadata": {
                        "labels": {
                            "app": "ml-pipeline-ui-artifact"
                        },
                        "annotations": {
                            ${istio_sidecar_annotation}
                            "kubeflow-pipelines/image-spec-hash": "${image_spec_hash}"
                        }
                    },
                    "spec": {
                        "containers": [{
                            "name": "ml-pipeline-ui-artifact",
                            "image": "${frontend_image}:${frontend_tag}",
                            "imagePullPolicy": "IfNotPresent",
                            "ports": [{"containerPort": 3000}],
                            "env": [
                                {
                                    "name": "MINIO_ACCESS_KEY",
                                    "valueFrom": {
                                        "secretKeyRef": {
                                            "key": "accesskey",
                                            "name": "mlpipeline-minio-artifact"
                                        }
                                    }
                                },
                                {
                                    "name": "MINIO_SECRET_KEY",
                                    "valueFrom": {
                                        "secretKeyRef": {
                                            "key": "secretkey",
                                            "name": "mlpipeline-minio-artifact"
                                        }
                                    }
                                },
                                {
                                    "name": "ML_PIPELINE_SERVICE_HOST",
                                    "value": "${ml_pipeline_service_host}"
                                },
                                {
                                    "name": "ML_PIPELINE_SERVICE_PORT",
                                    "value": "8888"
                                },
                                {
                                    "name": "FRONTEND_SERVER_NAMESPACE",
                                    "value": "${namespace}"
                                },
                                {
                                    "name": "CLUSTER_DOMAIN",
                                    "value": "${cluster_domain}"
                                }
                            ],
                            "resources": {
                                "requests": {
                                    "cpu": "10m",
                                    "memory": "70Mi"
                                },
                                "limits": {
                                    "cpu": "100m",
                                    "memory": "500Mi"
                                }
                            }
                        }],
                        "serviceAccountName": "default-editor"
                    }
                }
            }
        },
        {
            "apiVersion": "v1",
            "kind": "Service",
            "metadata": {
                "name": "ml-pipeline-ui-artifact",
                "namespace": "${namespace}",
                "labels": {
                    "app": "ml-pipeline-ui-artifact"
                }
            },
            "spec": {
                "ports": [{
                    "name": "http",
                    "port": 80,
                    "protocol": "TCP",
                    "targetPort": 3000
                }],
                "selector": {
                    "app": "ml-pipeline-ui-artifact"
                }
            }
        }
    ]
}