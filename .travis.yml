language: go
services:
- docker
addons:
  apt:
    packages:
      # This is required to avoid an Error: kill ESRCH failure on Travis at the
      # end of the test run
      - libnss3
      - python3
      - python3-pip
  chrome: stable

go:
  - "1.10"
node_js:
  - "8.9"

script:
  # API server tests
  - cd $TRAVIS_BUILD_DIR/backend/src
  # TODO(IronPan): use go dep https://github.com/googleprivate/ml/issues/561
  - rm -r $GOPATH/src/k8s.io/kubernetes/vendor/github.com/golang/glog
  - go test -v ./...

  # Frontend tests
  - cd $TRAVIS_BUILD_DIR/frontend
  - npm i
  - npm start &
  - cd test
  - npm i
  - ./node_modules/.bin/wait-on http-get://localhost:3000/apis/v1alpha1/healthz
  - npm run -s component-tests
  - npm run -s mock-e2e-tests
  - npm run -s unit-tests
  - pkill -f webpack-dev-server

  # DSL tests
  - cd $TRAVIS_BUILD_DIR/dsl
  - sudo pip3 install .
  - python3 tests/pipeline_param_tests.py
