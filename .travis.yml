language: go
services:
- docker
addons:
  apt:
    packages:
      # This is required to avoid an Error: kill ESRCH failure on Travis at the
      # end of the test run
      - libnss3
      - python3
      - python3-pip
  chrome: stable

go:
  - "1.10"
node_js:
  - "8.9"

script:
  # Frontend tests
  - cd $TRAVIS_BUILD_DIR/frontend
  - npm i
  - npm start &
  - cd test
  - npm i
  - ./node_modules/.bin/wait-on http-get://localhost:3000/apis/v1alpha2/healthz
  - npm run -s component-tests
  - npm run -s mock-e2e-tests
  - npm run -s unit-tests
  - pkill -f webpack-dev-server

  # DSL tests
  - cd $TRAVIS_BUILD_DIR/dsl
  - sudo pip3 install typing
  - sudo pip3 install .
  - python3 tests/main.py

  # DSL compiler tests
  - cd $TRAVIS_BUILD_DIR/dsl-compiler
  - sudo pip3 install .
  - python3 tests/main.py
