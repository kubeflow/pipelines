# Copyright 2018 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

language: go
services:
- docker
addons:
  apt:
    packages:
      # This is required to avoid an Error: kill ESRCH failure on Travis at the
      # end of the test run
      - libnss3
      - python3
      - python3-pip
  chrome: stable

go:
  - "1.10"
node_js:
  - "8.9"

script:
  # Frontend tests
  - cd $TRAVIS_BUILD_DIR/frontend
  - npm i
  - npm start &
  - cd test
  - ./node_modules/.bin/wait-on http-get://localhost:3000/apis/v1alpha2/healthz
  - npm run -s component-tests
  - npm run -s mock-e2e-tests
  - npm run -s unit-tests
  - pkill -f webpack-dev-server

  # DSL tests
  - cd $TRAVIS_BUILD_DIR/dsl
  - sudo pip3 install typing
  - sudo pip3 install .
  - python3 tests/main.py

  # DSL compiler tests
  - cd $TRAVIS_BUILD_DIR/dsl-compiler
  - sudo pip3 install .
  - python3 tests/main.py
