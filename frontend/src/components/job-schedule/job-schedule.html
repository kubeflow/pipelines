<!--
  Copyright 2018 Google LLC

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<dom-module id="job-schedule">
  <template>
    <link rel="stylesheet" href="./job-schedule.css">

    <style>
      /*
      This is here instead of in the .css file because of css-loader, which
      tries to validate CSS while loading, and ends up commenting out all
      mixins, since they're not officially in the CSS spec.
      */
      paper-dropdown-menu, paper-input {
        --paper-input-container: {
          padding: 0;
        }
        --paper-input-container-label: {
          box-sizing: border-box;
          padding: 0 8px;
        }
        --paper-input-container-input: {
          box-sizing: border-box;
          font-size: 14px;
          padding: 0 6px;
        }
        --paper-input-container-label-floating: {
          color: #000;
          font-size: 18px;
          font-weight: bold;
          padding: 0 8px;
        }
        --paper-input-error: {
          padding: 0 6px;
        }
        --paper-menu-button-content: {
          border-radius: 5px;
        }

        /* Ensure the ripple fills the whole element */
        --paper-dropdown-menu-ripple: {
          bottom: 0px;
          left: 0;
          right: 0;
          top: 0px;
        }
      }
      paper-dropdown-menu.disabled, paper-input.disabled, paper-textarea.disabled {
        --paper-input-container-label-floating: {
          color: var(--secondary-text-color);
          font-size: 18px;
          font-weight: bold;
          padding: 0 8px;
        }
      }

      .error-overflow {
        --paper-input-error: {
          overflow: visible;
        }
      }

      paper-input.cron-expression {
        width: 240px;
        --paper-input-container-disabled: {
          opacity: 0.7;
        }
        --paper-input-container-input: {
          font-family: 'Roboto Mono', monospace;
          padding-left: 6px;
        }
      }
    </style>

    <div class="flex">
      <paper-dropdown-menu id="scheduleTypeDropdown" class="shaded input-field-large" label="Type">
        <paper-listbox id="scheduleTypeListbox" slot="dropdown-content" class="dropdown-content"
                       selected="{{_scheduleTypeIndex}}">
          <template is="dom-repeat" items="[[_SCHEDULES]]" as="schedule">
            <paper-item>[[schedule]]</paper-item>
          </template>
        </paper-listbox>
      </paper-dropdown-menu>
    </div>

    <br>

    <div class="flex">
      <span class="font-large align-max-concurrency">Maximum concurrent runs</span>
      <div>
        <paper-input id="maxConcurrentRuns" required value="{{_maxConcurrentRuns}}" no-label-float
                     class="shaded input-field-width-45 error-overflow center-text"
                     error-message="Please enter a value between 1 and 100" maxLength="3"
                     allowed-pattern="\d+" invalid="[[!_maxConcurrentRunsIsValid]]">
        </paper-input>
      </div>
    </div>

    <div class="flex-column">
      <template is="dom-if" if="{{_showDateTimePickers(_scheduleTypeIndex)}}">

        <date-time-picker id="startDateTimePicker" datetime="{{_startDate}}"
                          valid="{{_startIsValid}}" name="start">
        </date-time-picker>
        <date-time-picker id="endDateTimePicker" datetime="{{_endDate}}"
                          valid="{{_endIsValid}}" name="end">
        </date-time-picker>
      </template>

      <!-- Periodic scheduling UI -->
      <template is="dom-if" if="{{_showPeriodicInputs(_scheduleTypeIndex)}}">
        <div class="flex">
          <span class="font-large align-left">Run every</span>
          <paper-input id="frequency" class="shaded input-field-width-45 padded-right" required
                       no-label-float value="{{_frequency}}" maxlength="3" allowed-pattern="\d+">
          </paper-input>

          <!-- Recurrence interval -->
          <paper-dropdown-menu id="periodicIntervalDropdown"
                               class="shaded input-field-small error-overflow" no-label-float>
            <paper-listbox id="periodicIntervalListbox" slot="dropdown-content"
                           class="dropdown-content" selected="{{_intervalIndex}}">
              <template is="dom-repeat" items="[[_periodicIntervals]]" as="interval">
                <paper-item>[[interval]]</paper-item>
              </template>
            </paper-listbox>
          </paper-dropdown-menu>
        </div>
      </template>

      <!-- Cron scheduling UI -->
      <template is="dom-if" if="{{_showCronInputs(_scheduleTypeIndex)}}">
        <div class="flex">
          <span class="font-large align-left">Run</span>

          <paper-dropdown-menu id="cronIntervalDropdown" class="input-field-small error-overflow"
                               disabled="[[_allowEditingCronExpression]]"
                               no-label-float invalid="[[!_weekdaySelectionIsValid]]"
                               error-message="Please select at least one weekday">
            <paper-listbox id="cronIntervalListbox" slot="dropdown-content" class="dropdown-content"
                           selected="{{_intervalIndex}}">
              <template is="dom-repeat" items="[[_cronIntervals]]" as="interval">
                <paper-item>[[interval]]</paper-item>
              </template>
            </paper-listbox>
          </paper-dropdown-menu>
        </div>

        <!-- Weekday picker -->
        <div class="flex font-large">
          <span class="align-left">on</span>
          <paper-checkbox id="allWeekdaysCheckbox"
                          disabled="[[_disableWeekdayButtons(_enableWeekdayButtons, _allowEditingCronExpression)]]"
                          checked="{{_allDaysOfWeekActive}}"
                          on-checked-changed="_selectAllWeekdaysCheckboxChanged">
          All
          </paper-checkbox>
          <span class="padded-spacing-minus-4">-</span>
          <span id="weekdayButtons">
            <template is="dom-repeat" items="{{_weekdays}}" as="weekday">
              <paper-button class="toggle" active="{{weekday.active}}" toggles
                            disabled="[[_disableWeekdayButtons(_enableWeekdayButtons, _allowEditingCronExpression)]]">
                [[weekday.day]]
              </paper-button>
            </template>
          </span>
        </div>

        <div class="font-medium">
          <paper-checkbox id="allowEditingCron" class="align-left"
                          checked="{{_allowEditingCronExpression}}">
            Allow editing cron expression. (format is specified
            <a href="https://godoc.org/github.com/robfig/cron#hdr-CRON_Expression_Format"
               target="blank">here</a>)
          </paper-checkbox>
        </div>

        <!-- Cron expression text field -->
        <div class="flex">
          <paper-input id="cronExpression" class="cron-expression disabled" label="cron expression"
                       tabindex="-1" value="{{_cronExpression}}">
          </paper-input>
        </div>
        <div class="cron-note">Note: Start and end dates/times are handled outside of cron.</div>

      </template>

      <br>

      <!-- General purpose error messages for schedule component -->
      <div class="error-msg-container">
        <span class="error-msg" hidden="[[!_errorMsg]]">
          [[_errorMsg]]
        </span>
      </div>

    </div>

  </template>
</dom-module>
