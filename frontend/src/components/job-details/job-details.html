<dom-module id="job-details">
  <template>
    <link rel="stylesheet" href="./job-details.css">

    <div class="toolbar">
      <div class="toolbar-title">Job Details</div>
    </div>

    <div class="padded-20">
      <div class="flex">
        <div class="job-name padded">[[job.name]]</div>
        <div class="right">
          <div class="flex">
            <iron-icon class="status-icon" icon=[[_getStatusIcon(job.status)]]></iron-icon>
            <!-- TODO: Get or compute the job progress here -->
            <paper-progress id="progress" value="100"></paper-progress>
          </div>
          <div>
            <span class="status">[[job.status]]</span>
          </div>
        </div>
      </div>

      <div class="tabs-container">
        <paper-tabs class="no-shrink" selected="{{selectedTab}}">
          <paper-tab>Basic Info</paper-tab>
          <paper-tab>Output</paper-tab>
          <paper-tab>Graph</paper-tab>
        </paper-tabs>
      </div>

      <iron-pages selected="{{selectedTab}}">

        <!-- iron-page tab 1 -->
        <div>
          <br/>
          <div class="details-table">
            <div>
              <span class="detail-title">Status</span>
              <span>[[job.status]]</span>
            </div>
            <div>
              <span class="detail-title">Created at</span>
              <span>[[_dateToString(job.createdAt)]]</span>
            </div>
            <div>
              <span class="detail-title">Started at</span>
              <span>[[_dateToString(job.startedAt)]]</span>
            </div>
            <div>
              <span class="detail-title">Finished at</span>
              <span>[[_dateToString(job.finishedAt)]]</span>
            </div>
            <div>
              <span class="detail-title">Duration</span>
              <span>[[_getRuntime(job.startedAt, job.finishedAt, job.status)]]</span>
            </div>
          </div>
        </div>

        <!-- iron-page tab 2 -->
        <div id="plotContainer">
          <template is="dom-repeat" items="[[outputPlots]]" as="plotMetadata">
            <data-plot plot-metadata="[[plotMetadata]]"></data-plot>
          </template>
        </div>

        <!-- iron-page tab 3 -->
        <div class="pipeline-dag">
          <template is="dom-repeat" items="[[_workflowNodes]]" as="node">
            <div class="pipeline-node" style$="left: [[node.x]]px; top: [[node.y]]px; width: [[node.width]]px; height: [[node.height]]px">
              <div class="label">[[node.label]]</div>
            </div>
          </template>

          <template is="dom-repeat" items="[[_workflowEdges]]" as="edge">
            <div class="pipeline-edge">
              <template is="dom-repeat" items="[[edge.lines]]" as="line">
                <div class="line" style$="width: [[line.distance]]px; left: [[line.left]]px;
                                  top: [[line.yMid]]px; transform: translate(100px, 35px) rotate([[line.angle]]deg)"></div>
              </template>
            </div>
          </template>
        </div>
      </iron-pages>

  </template>
</dom-module>