<dom-module id="pipeline-schedule">
  <template>
    <link rel="stylesheet" href="./pipeline-schedule.css">

    <style>
      /*
      This is here instead of in the .css file because of css-loader, which
      tries to validate CSS while loading, and ends up commenting out all
      mixins, since they're not officially in the CSS spec.
      */
      paper-dropdown-menu, paper-input {
        --paper-input-container: {
          padding: 0;
        }
        --paper-input-container-label: {
          padding-left: 6px;
        }
        --paper-input-container-input: {
          padding-left: 6px;
        }
        --paper-input-container-label-floating: {
          padding-left: 8px;
        }
        --paper-input-error: {
          padding-left: 6px;
        }

        /* Ensure the ripple fills the whole element */
        --paper-dropdown-menu-ripple: {
          bottom: 0px;
          left: 0;
          right: 0;
          top: 0px;
        }
      }

      paper-input.error-overflow {
        --paper-input-error: {
          overflow: visible;
        }
      }
    </style>

    <div class="flex metadata-input">
      <paper-dropdown-menu label="Type">
        <paper-listbox slot="dropdown-content" class="dropdown-content"
                       selected="{{_scheduleTypeIndex}}">
          <template is="dom-repeat" items="[[_SCHEDULES]]" as="schedule">
            <paper-item>[[schedule]]</paper-item>
          </template>
        </paper-listbox>
      </paper-dropdown-menu>
    </div>

    <!-- TODO: vertically align the various input fields below. -->

    <!-- Starting date and time selectors -->
    <template is="dom-if"
              if="{{_showSpecificTimeScheduleInputs(_scheduleTypeIndex)}}">
      <div class="flex metadata-input padded-left">
        <!-- Start date picker -->
        <paper-input class="error-overflow" label="Starts (YYYY/MM/DD)"
                     value="{{_startDate}}" on-click="_pickStartDate"
                     allowed-pattern="[0-9/]" invalid="[[!_startTimeIsValid]]"
                     error-message="[[_startTimeErrorMessage]]">
        </paper-input>

        <span class="padded">at</span>

        <!-- Start time picker -->
        <paper-dropdown-menu class="param-input-small" label="Time"
                             invalid="[[!_startTimeIsValid]]">
          <paper-listbox slot="dropdown-content" selected="{{_startTimeIndex}}">
            <template is="dom-repeat" items="[[_times]]" as="time">
              <paper-item>[[time]]</paper-item>
            </template>
          </paper-listbox>
        </paper-dropdown-menu>
        <span class="padded">AM</span>
        <paper-toggle-button class="am-pm" checked="{{_isStartPM}}">
        </paper-toggle-button>
        <span class="padded">PM</span>
      </div>

      <!-- Recurrence frequency and interval -->
      <template is="dom-if"
                if="{{_showRecurringScheduleInputs(_scheduleTypeIndex)}}">
        <div class="flex metadata-input">
          <span class="padded">Repeat every</span>

          <paper-input label="Frequency" value="{{_runIntervalFrequency}}"
                       min="1" max="999" type="number" auto-validate
                       allowed-pattern="[0-9]"
                       error-message="Must be number between 1 and 999">
          </paper-input>

          <span class="padded"></span>

          <!-- TODO: Add "certain days of the week" as interval type -->
          <paper-dropdown-menu id="runIntervalDropdown"
                               class="param-input-small" label="Interval">
            <paper-listbox slot="dropdown-content" class="dropdown-content"
                           selected="{{_runIntervalIndex}}">
              <template is="dom-repeat" items="[[_runIntervals]]" as="interval">
                <paper-item>[[interval]]</paper-item>
              </template>
            </paper-listbox>
          </paper-dropdown-menu>
        </div>

        <!-- Optional Ending date and time selectors -->
        <div class="flex param-container">
          <!--
            This element ends up 5px smaller than inputs, so without the extra
            margin, the screen jumps when the checkbox is (un)checked.
          -->
          <span class="padded checkbox-margin-adjust">
            <paper-checkbox checked="{{_hasEndDate}}">Has end</paper-checkbox>
          </span>
          <template is="dom-if" if="[[_hasEndDate]]">
            <!-- End date picker -->
            <paper-input class="error-overflow" label="Ends (YYYY/MM/DD)"
                         value="[[_endDate]]" on-click="_pickEndDate"
                         allowed-pattern="[0-9/]" invalid="[[!_endTimeIsValid]]"
                         error-message="[[_endTimeErrorMessage]]">
            </paper-input>

            <span class="padded">at</span>

            <!-- End time picker -->
            <paper-dropdown-menu class="param-input-small" label="Time"
                                 invalid="[[!_endTimeIsValid]]">
              <paper-listbox slot="dropdown-content"
                             selected="{{_endTimeIndex}}">
                <template is="dom-repeat" items="[[_times]]" as="time">
                  <paper-item>[[time]]</paper-item>
                </template>
              </paper-listbox>
            </paper-dropdown-menu>
            <span class="padded">AM</span>
            <paper-toggle-button class="am-pm" checked="{{_isEndPM}}">
            </paper-toggle-button>
            <span class="padded">PM</span>
          </template>
        </div>
      </template>
    </template>
    <app-datepicker-dialog with-backdrop id="startDatepicker"
                           disable-days="[]" min-date="[[_minStartDate]]"
                           date="{{_startDate}}">
    </app-datepicker-dialog>
    <app-datepicker-dialog with-backdrop id="endDatepicker" disable-days="[]"
                           min-date="[[_startDate]]" date="{{_endDate}}">
    </app-datepicker-dialog>

    </template>
</dom-module>
