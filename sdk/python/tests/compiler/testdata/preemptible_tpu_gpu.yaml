apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  annotations:
    pipelines.kubeflow.org/pipeline_spec: '{"description": "shows how to use dsl.Condition.", "inputs": [], "name": "pipeline flip coin"}'
  generateName: pipeline-flip-coin-
spec:
  arguments:
    parameters: []
  entrypoint: pipeline-flip-coin
  serviceAccountName: pipeline-runner
  templates:
    - container:
        args:
          - python -c "import random; result = 'heads' if random.randint(0,1) == 0 else
            'tails'; print(result)" | tee /tmp/output
        command:
          - sh
          - -c
        image: python:alpine3.6
        resources:
          limits:
            nvidia.com/gpu: 1
      name: flip
      nodeSelector:
        cloud.google.com/gke-preemptible: 'true'
      outputs:
        artifacts:
          - name: mlpipeline-ui-metadata
            optional: true
            path: /mlpipeline-ui-metadata.json
          - name: mlpipeline-metrics
            optional: true
            path: /mlpipeline-metrics.json
        parameters:
          - name: flip-output
            valueFrom:
              path: /tmp/output
      retryStrategy:
        limit: 5
      tolerations:
        - effect: NoSchedule
          key: preemptible
          operator: Equal
          value: 'true'
    - dag:
        tasks:
          - name: flip
            template: flip
      name: pipeline-flip-coin