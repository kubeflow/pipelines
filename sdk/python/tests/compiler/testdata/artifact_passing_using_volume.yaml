apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: artifact-passing-pipeline-
  annotations: {pipelines.kubeflow.org/kfp_sdk_version: 1.7.0, pipelines.kubeflow.org/pipeline_compilation_time: '2021-08-08T21:54:13.408466',
    pipelines.kubeflow.org/pipeline_spec: '{"name": "Artifact passing pipeline"}'}
  labels: {pipelines.kubeflow.org/kfp_sdk_version: 1.7.0}
spec:
  entrypoint: artifact-passing-pipeline
  templates:
  - name: artifact-passing-pipeline
    dag:
      tasks:
      - name: consumer
        template: consumer
        dependencies: [processor]
        arguments:
          parameters:
          - {name: processor-Output-1, value: '{{tasks.processor.outputs.parameters.processor-Output-1}}'}
          - {name: processor-Output-1-subpath, value: '{{tasks.processor.outputs.parameters.processor-Output-1-subpath}}'}
          - {name: processor-Output-2-subpath, value: '{{tasks.processor.outputs.parameters.processor-Output-2-subpath}}'}
      - name: processor
        template: processor
        dependencies: [producer]
        arguments:
          parameters:
          - {name: producer-Output-1, value: '{{tasks.producer.outputs.parameters.producer-Output-1}}'}
          - {name: producer-Output-1-subpath, value: '{{tasks.producer.outputs.parameters.producer-Output-1-subpath}}'}
          - {name: producer-Output-2-subpath, value: '{{tasks.producer.outputs.parameters.producer-Output-2-subpath}}'}
      - {name: producer, template: producer}
  - name: consumer
    container:
      args: ['{{inputs.parameters.processor-Output-1}}', /tmp/inputs/Input_artifact/data]
      command:
      - sh
      - -c
      - |
        echo "Input parameter = $0"
        echo "Input artifact = " && cat "$1"
      image: alpine
      volumeMounts:
      - {mountPath: /tmp/inputs/Input_artifact, name: data-storage, subPath: '{{inputs.parameters.processor-Output-2-subpath}}',
        readOnly: true}
      - {mountPath: /tmp/inputs/Input_parameter, name: data-storage, subPath: '{{inputs.parameters.processor-Output-1-subpath}}',
        readOnly: true}
    inputs:
      parameters:
      - {name: processor-Output-1}
      - {name: processor-Output-2-subpath}
      - {name: processor-Output-1-subpath}
    metadata:
      labels:
        pipelines.kubeflow.org/kfp_sdk_version: 1.7.0
        pipelines.kubeflow.org/pipeline-sdk-type: kfp
        pipelines.kubeflow.org/enable_caching: "true"
      annotations: {pipelines.kubeflow.org/component_spec: '{"implementation": {"container":
          {"args": [{"inputValue": "Input parameter"}, {"inputPath": "Input artifact"}],
          "command": ["sh", "-c", "echo \"Input parameter = $0\"\necho \"Input artifact
          = \" && cat \"$1\"\n"], "image": "alpine"}}, "inputs": [{"name": "Input
          parameter"}, {"name": "Input artifact"}], "name": "Consumer"}', pipelines.kubeflow.org/component_ref: '{"digest":
          "1a8ea3c29c7853bf63d9b4fbd76a66b273621d2229c3cfe08ed68620ebf02982", "url":
          "/Users/ajaygopinathan/Code/github.com/neuromage/pipelines/sdk/python/tests/compiler/testdata/test_data/consume_2.component.yaml"}',
        pipelines.kubeflow.org/arguments.parameters: '{"Input parameter": "{{inputs.parameters.processor-Output-1}}"}'}
  - name: processor
    container:
      args: ['{{inputs.parameters.producer-Output-1}}', /tmp/inputs/Input_artifact/data,
        /tmp/outputs/Output_1/data, /tmp/outputs/Output_2/data]
      command:
      - sh
      - -c
      - |
        mkdir -p "$(dirname "$2")"
        mkdir -p "$(dirname "$3")"
        echo "$0" > "$2"
        cp "$1" "$3"
      image: alpine
      volumeMounts:
      - {mountPath: /tmp/inputs/Input_artifact, name: data-storage, subPath: '{{inputs.parameters.producer-Output-2-subpath}}',
        readOnly: true}
      - {mountPath: /tmp/inputs/Input_parameter, name: data-storage, subPath: '{{inputs.parameters.producer-Output-1-subpath}}',
        readOnly: true}
      - {mountPath: /tmp/outputs/Output_1, name: data-storage, subPath: 'artifact_data/{{workflow.uid}}_{{pod.name}}/processor-Output-1'}
      - {mountPath: /tmp/outputs/Output_2, name: data-storage, subPath: 'artifact_data/{{workflow.uid}}_{{pod.name}}/processor-Output-2'}
    inputs:
      parameters:
      - {name: producer-Output-1}
      - {name: producer-Output-2-subpath}
      - {name: producer-Output-1-subpath}
    outputs:
      parameters:
      - name: processor-Output-1
        valueFrom: {path: /tmp/outputs/Output_1/data}
      - {name: processor-Output-1-subpath, value: 'artifact_data/{{workflow.uid}}_{{pod.name}}/processor-Output-1'}
      - {name: processor-Output-2-subpath, value: 'artifact_data/{{workflow.uid}}_{{pod.name}}/processor-Output-2'}
    metadata:
      labels:
        pipelines.kubeflow.org/kfp_sdk_version: 1.7.0
        pipelines.kubeflow.org/pipeline-sdk-type: kfp
        pipelines.kubeflow.org/enable_caching: "true"
      annotations: {pipelines.kubeflow.org/component_spec: '{"implementation": {"container":
          {"args": [{"inputValue": "Input parameter"}, {"inputPath": "Input artifact"},
          {"outputPath": "Output 1"}, {"outputPath": "Output 2"}], "command": ["sh",
          "-c", "mkdir -p \"$(dirname \"$2\")\"\nmkdir -p \"$(dirname \"$3\")\"\necho
          \"$0\" > \"$2\"\ncp \"$1\" \"$3\"\n"], "image": "alpine"}}, "inputs": [{"name":
          "Input parameter"}, {"name": "Input artifact"}], "name": "Processor", "outputs":
          [{"name": "Output 1"}, {"name": "Output 2"}]}', pipelines.kubeflow.org/component_ref: '{"digest":
          "f11a277f5c5cbc27a2e2cda412547b607671d88a4e7aa8a1665dadb836b592b3", "url":
          "/Users/ajaygopinathan/Code/github.com/neuromage/pipelines/sdk/python/tests/compiler/testdata/test_data/process_2_2.component.yaml"}',
        pipelines.kubeflow.org/arguments.parameters: '{"Input parameter": "{{inputs.parameters.producer-Output-1}}"}'}
  - name: producer
    container:
      args: [/tmp/outputs/Output_1/data, /tmp/outputs/Output_2/data]
      command:
      - sh
      - -c
      - |
        mkdir -p "$(dirname "$0")"
        mkdir -p "$(dirname "$1")"
        echo "Data 1" > $0
        echo "Data 2" > $1
      image: alpine
      volumeMounts:
      - {mountPath: /tmp/outputs/Output_1, name: data-storage, subPath: 'artifact_data/{{workflow.uid}}_{{pod.name}}/producer-Output-1'}
      - {mountPath: /tmp/outputs/Output_2, name: data-storage, subPath: 'artifact_data/{{workflow.uid}}_{{pod.name}}/producer-Output-2'}
    outputs:
      parameters:
      - name: producer-Output-1
        valueFrom: {path: /tmp/outputs/Output_1/data}
      - {name: producer-Output-1-subpath, value: 'artifact_data/{{workflow.uid}}_{{pod.name}}/producer-Output-1'}
      - {name: producer-Output-2-subpath, value: 'artifact_data/{{workflow.uid}}_{{pod.name}}/producer-Output-2'}
    metadata:
      labels:
        pipelines.kubeflow.org/kfp_sdk_version: 1.7.0
        pipelines.kubeflow.org/pipeline-sdk-type: kfp
        pipelines.kubeflow.org/enable_caching: "true"
      annotations: {pipelines.kubeflow.org/component_spec: '{"implementation": {"container":
          {"args": [{"outputPath": "Output 1"}, {"outputPath": "Output 2"}], "command":
          ["sh", "-c", "mkdir -p \"$(dirname \"$0\")\"\nmkdir -p \"$(dirname \"$1\")\"\necho
          \"Data 1\" > $0\necho \"Data 2\" > $1\n"], "image": "alpine"}}, "name":
          "Producer", "outputs": [{"name": "Output 1"}, {"name": "Output 2"}]}', pipelines.kubeflow.org/component_ref: '{"digest":
          "7399eb54ee94a95708fa9f8a47330a39258b22a319a48458e14a63dcedb87ea4", "url":
          "/Users/ajaygopinathan/Code/github.com/neuromage/pipelines/sdk/python/tests/compiler/testdata/test_data/produce_2.component.yaml"}'}
  arguments:
    parameters: []
  serviceAccountName: pipeline-runner
  volumes:
  - name: data-storage
    persistentVolumeClaim: {claimName: data-volume}
