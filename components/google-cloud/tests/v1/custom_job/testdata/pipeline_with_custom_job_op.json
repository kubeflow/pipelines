{
  "pipelineInfo":{
     "name":"pipeline"
  },
  "sdkVersion":"kfp-2.0.0-rc.1",
  "schemaVersion":"2.1.0",
  "deploymentSpec":{
     "executors":{
        "exec-custom-training-job":{
           "container":{
              "command":[
                 "python3",
                 "-u",
                 "-m",
                 "google_cloud_pipeline_components.container.v1.custom_job.launcher"
              ],
              "image":"gcr.io/ml-pipeline/google-cloud-pipeline-components:2.0.0b3",
              "args":[
                 "--type",
                 "CustomJob",
                 "--payload",
                 "{\"display_name\": \"{{$.inputs.parameters['display_name']}}\", \"job_spec\": {\"worker_pool_specs\": {{$.inputs.parameters['worker_pool_specs']}}, \"scheduling\": {\"timeout\": \"{{$.inputs.parameters['timeout']}}\", \"restart_job_on_worker_restart\": {{$.inputs.parameters['restart_job_on_worker_restart']}}}, \"service_account\": \"{{$.inputs.parameters['service_account']}}\", \"tensorboard\": \"{{$.inputs.parameters['tensorboard']}}\", \"enable_web_access\": {{$.inputs.parameters['enable_web_access']}}, \"network\": \"{{$.inputs.parameters['network']}}\", \"reserved_ip_ranges\": {{$.inputs.parameters['reserved_ip_ranges']}}, \"base_output_directory\": {\"output_uri_prefix\": \"{{$.inputs.parameters['base_output_directory']}}\"}}, \"labels\": {{$.inputs.parameters['labels']}}, \"encryption_spec_key_name\": {\"kms_key_name\": \"{{$.inputs.parameters['encryption_spec_key_name']}}\"}}",
                 "--project",
                 "{{$.inputs.parameters['project']}}",
                 "--location",
                 "{{$.inputs.parameters['location']}}",
                 "--gcp_resources",
                 "{{$.outputs.parameters['gcp_resources'].output_file}}"
              ]
           }
        }
     }
  },
  "components":{
     "comp-custom-training-job":{
        "inputDefinitions":{
           "parameters":{
              "enable_web_access":{
                 "parameterType":"BOOLEAN",
                 "defaultValue":false,
                 "isOptional":true
              },
              "display_name":{
                 "parameterType":"STRING"
              },
              "reserved_ip_ranges":{
                 "parameterType":"LIST",
                 "defaultValue":[

                 ],
                 "isOptional":true
              },
              "network":{
                 "parameterType":"STRING",
                 "defaultValue":"",
                 "isOptional":true
              },
              "base_output_directory":{
                 "parameterType":"STRING",
                 "defaultValue":"",
                 "isOptional":true
              },
              "timeout":{
                 "parameterType":"STRING",
                 "defaultValue":"604800s",
                 "isOptional":true
              },
              "encryption_spec_key_name":{
                 "parameterType":"STRING",
                 "defaultValue":"",
                 "isOptional":true
              },
              "location":{
                 "parameterType":"STRING",
                 "defaultValue":"us-central1",
                 "isOptional":true
              },
              "worker_pool_specs":{
                 "parameterType":"LIST",
                 "defaultValue":[

                 ],
                 "isOptional":true
              },
              "project":{
                 "parameterType":"STRING"
              },
              "tensorboard":{
                 "parameterType":"STRING",
                 "defaultValue":"",
                 "isOptional":true
              },
              "service_account":{
                 "parameterType":"STRING",
                 "defaultValue":"",
                 "isOptional":true
              },
              "restart_job_on_worker_restart":{
                 "parameterType":"BOOLEAN",
                 "defaultValue":false,
                 "isOptional":true
              },
              "labels":{
                 "parameterType":"STRUCT",
                 "defaultValue":{

                 },
                 "isOptional":true
              }
           }
        },
        "outputDefinitions":{
           "parameters":{
              "gcp_resources":{
                 "parameterType":"STRING"
              }
           }
        },
        "executorLabel":"exec-custom-training-job"
     }
  },
  "root":{
     "dag":{
        "tasks":{
           "custom-training-job":{
              "taskInfo":{
                 "name":"custom-training-job"
              },
              "inputs":{
                 "parameters":{
                    "base_output_directory":{
                       "runtimeValue":{
                          "constant":"gs://my-vertex-pipelines-bucket/custom_job_outputs/"
                       }
                    },
                    "project":{
                       "runtimeValue":{
                          "constant":"my-project"
                       }
                    },
                    "tensorboard":{
                       "runtimeValue":{
                          "constant":"projects/000000000000/locations/us-central1/tensorboards/000000000000"
                       }
                    },
                    "labels":{
                       "runtimeValue":{
                          "constant":{
                             "k":"v"
                          }
                       }
                    },
                    "restart_job_on_worker_restart":{
                       "runtimeValue":{
                          "constant":true
                       }
                    },
                    "reserved_ip_ranges":{
                       "runtimeValue":{
                          "constant":[
                             "1.0.0.0"
                          ]
                       }
                    },
                    "display_name":{
                       "runtimeValue":{
                          "constant":"job_display_name"
                       }
                    },
                    "location":{
                       "runtimeValue":{
                          "constant":"us-central1"
                       }
                    },
                    "worker_pool_specs":{
                       "runtimeValue":{
                          "constant":[
                             {
                                "machine_spec":{
                                   "accelerator_type":"NVIDIA_TESLA_T4",
                                   "machine_type":"n1-standard-4",
                                   "accelerator_count":1.0
                                },
                                "replica_count":1.0,
                                "container_spec":{
                                   "image_uri":"alpine"
                                }
                             }
                          ]
                       }
                    },
                    "timeout":{
                       "runtimeValue":{
                          "constant":"1000s"
                       }
                    },
                    "service_account":{
                       "runtimeValue":{
                          "constant":"my-vertex-service-account@my-project.iam.gserviceaccount.com"
                       }
                    },
                    "enable_web_access":{
                       "runtimeValue":{
                          "constant":true
                       }
                    }
                 }
              },
              "cachingOptions":{
                 "enableCache":true
              },
              "componentRef":{
                 "name":"comp-custom-training-job"
              }
           }
        }
     }
  }
}