{
  "pipelineInfo":{
    "name":"custom-training-job"
  },
  "deploymentSpec":{
    "executors":{
      "exec-custom-training-job":{
        "container":{
          "image":"gcr.io/ml-pipeline/google-cloud-pipeline-components:2.0.0b3",
          "command":[
            "python3",
            "-u",
            "-m",
            "google_cloud_pipeline_components.container.v1.custom_job.launcher"
          ],
          "args":[
            "--type",
            "CustomJob",
            "--payload",
            "{\"Concat\": [\"{\", \"\\\"display_name\\\": \\\"\", \"{{$.inputs.parameters['display_name']}}\", \"\\\"\", \", \\\"job_spec\\\": {\", \"\\\"worker_pool_specs\\\": \", \"{{$.inputs.parameters['worker_pool_specs']}}\", \", \\\"scheduling\\\": {\", \"\\\"timeout\\\": \\\"\", \"{{$.inputs.parameters['timeout']}}\", \"\\\"\", \", \\\"restart_job_on_worker_restart\\\": \\\"\", \"{{$.inputs.parameters['restart_job_on_worker_restart']}}\", \"\\\"\", \"}\", \", \\\"service_account\\\": \\\"\", \"{{$.inputs.parameters['service_account']}}\", \"\\\"\", \", \\\"tensorboard\\\": \\\"\", \"{{$.inputs.parameters['tensorboard']}}\", \"\\\"\", \", \\\"enable_web_access\\\": \\\"\", \"{{$.inputs.parameters['enable_web_access']}}\", \"\\\"\", \", \\\"network\\\": \\\"\", \"{{$.inputs.parameters['network']}}\", \"\\\"\", \", \\\"reserved_ip_ranges\\\": \", \"{{$.inputs.parameters['reserved_ip_ranges']}}\", \", \\\"base_output_directory\\\": {\", \"\\\"output_uri_prefix\\\": \\\"\", \"{{$.inputs.parameters['base_output_directory']}}\", \"\\\"\", \"}\", \"}\", \", \\\"labels\\\": \", \"{{$.inputs.parameters['labels']}}\", \", \\\"encryption_spec\\\": {\\\"kms_key_name\\\":\\\"\", \"{{$.inputs.parameters['encryption_spec_key_name']}}\", \"\\\"}\", \"}\"]}",
            "--project",
            "{{$.inputs.parameters['project']}}",
            "--location",
            "{{$.inputs.parameters['location']}}",
            "--gcp_resources",
            "{{$.outputs.parameters['gcp_resources'].output_file}}"
          ]
        }
      }
    }
  },
  "components":{
    "comp-custom-training-job":{
      "inputDefinitions":{
        "parameters":{
          "worker_pool_specs":{
            "parameterType":"LIST",
            "defaultValue":[
              {
                "replica_count":1.0,
                "disk_spec":{
                  "boot_disk_size_gb":100.0,
                  "boot_disk_type":"pd-ssd"
                },
                "machine_spec":{
                  "machine_type":"n1-standard-4"
                },
                "container_spec":{
                  "args":[

                  ],
                  "image_uri":"google/cloud-sdk:latest",
                  "command":[
                    "sh",
                    "-c",
                    "set -e -x\necho \"$0, this is an output parameter\"\n",
                    "{{$.inputs.parameters['input_text']}}",
                    "{{$.outputs.parameters['output_value'].output_file}}"
                  ]
                }
              }
            ],
            "isOptional":true
          },
          "service_account":{
            "parameterType":"STRING",
            "defaultValue":"",
            "isOptional":true
          },
          "location":{
            "parameterType":"STRING",
            "defaultValue":"us-central1",
            "isOptional":true
          },
          "display_name":{
            "parameterType":"STRING",
            "defaultValue":"containercomponent"
          },
          "input_text":{
            "parameterType":"STRING"
          },
          "labels":{
            "parameterType":"STRUCT",
            "defaultValue":{

            },
            "isOptional":true
          },
          "enable_web_access":{
            "parameterType":"BOOLEAN",
            "defaultValue":false,
            "isOptional":true
          },
          "timeout":{
            "parameterType":"STRING",
            "defaultValue":"604800s",
            "isOptional":true
          },
          "project":{
            "parameterType":"STRING"
          },
          "reserved_ip_ranges":{
            "parameterType":"LIST",
            "defaultValue":[

            ],
            "isOptional":true
          },
          "tensorboard":{
            "parameterType":"STRING",
            "defaultValue":"",
            "isOptional":true
          },
          "restart_job_on_worker_restart":{
            "parameterType":"BOOLEAN",
            "defaultValue":false,
            "isOptional":true
          },
          "encryption_spec_key_name":{
            "parameterType":"STRING",
            "defaultValue":"",
            "isOptional":true
          },
          "network":{
            "parameterType":"STRING",
            "defaultValue":"",
            "isOptional":true
          },
          "base_output_directory":{
            "parameterType":"STRING",
            "defaultValue":"",
            "isOptional":true
          }
        }
      },
      "outputDefinitions":{
        "parameters":{
          "gcp_resources":{
            "parameterType":"STRING"
          },
          "output_value":{
            "parameterType":"STRING"
          }
        }
      },
      "executorLabel":"exec-custom-training-job"
    }
  },
  "root":{
    "inputDefinitions":{
      "parameters":{
        "service_account":{
          "parameterType":"STRING",
          "defaultValue":"",
          "isOptional":true
        },
        "enable_web_access":{
          "parameterType":"BOOLEAN",
          "defaultValue":false,
          "isOptional":true
        },
        "worker_pool_specs":{
          "parameterType":"LIST",
          "defaultValue":[
            {
              "machine_spec":{
                "machine_type":"n1-standard-4"
              },
              "disk_spec":{
                "boot_disk_size_gb":100.0,
                "boot_disk_type":"pd-ssd"
              },
              "container_spec":{
                "args":[

                ],
                "image_uri":"google/cloud-sdk:latest",
                "command":[
                  "sh",
                  "-c",
                  "set -e -x\necho \"$0, this is an output parameter\"\n",
                  "{{$.inputs.parameters['input_text']}}",
                  "{{$.outputs.parameters['output_value'].output_file}}"
                ]
              },
              "replica_count":1.0
            }
          ],
          "isOptional":true
        },
        "project":{
          "parameterType":"STRING"
        },
        "network":{
          "parameterType":"STRING",
          "defaultValue":"",
          "isOptional":true
        },
        "timeout":{
          "parameterType":"STRING",
          "defaultValue":"604800s",
          "isOptional":true
        },
        "reserved_ip_ranges":{
          "parameterType":"LIST",
          "defaultValue":[

          ],
          "isOptional":true
        },
        "restart_job_on_worker_restart":{
          "parameterType":"BOOLEAN",
          "defaultValue":false,
          "isOptional":true
        },
        "display_name":{
          "parameterType":"STRING",
          "defaultValue":"containercomponent"
        },
        "base_output_directory":{
          "parameterType":"STRING",
          "defaultValue":"",
          "isOptional":true
        },
        "location":{
          "parameterType":"STRING",
          "defaultValue":"us-central1",
          "isOptional":true
        },
        "labels":{
          "parameterType":"STRUCT",
          "defaultValue":{

          },
          "isOptional":true
        },
        "input_text":{
          "parameterType":"STRING"
        },
        "encryption_spec_key_name":{
          "parameterType":"STRING",
          "defaultValue":"",
          "isOptional":true
        },
        "tensorboard":{
          "parameterType":"STRING",
          "defaultValue":"",
          "isOptional":true
        }
      }
    },
    "outputDefinitions": {
        "parameters": {
            "gcp_resources": {
                "parameterType": "STRING"
            }
        }
    },
    "dag":{
      "outputs": {
          "parameters": {
              "gcp_resources": {
                  "valueFromParameter": {
                      "outputParameterKey": "gcp_resources",
                      "producerSubtask": "custom-training-job"
                  }
              }
          }
      },
      "tasks":{
        "custom-training-job":{
          "taskInfo":{
            "name":"custom-training-job"
          },
          "inputs":{
            "parameters":{
              "tensorboard":{
                "componentInputParameter":"tensorboard"
              },
              "timeout":{
                "componentInputParameter":"timeout"
              },
              "network":{
                "componentInputParameter":"network"
              },
              "service_account":{
                "componentInputParameter":"service_account"
              },
              "labels":{
                "componentInputParameter":"labels"
              },
              "restart_job_on_worker_restart":{
                "componentInputParameter":"restart_job_on_worker_restart"
              },
              "display_name":{
                "componentInputParameter":"display_name"
              },
              "location":{
                "componentInputParameter":"location"
              },
              "worker_pool_specs":{
                "componentInputParameter":"worker_pool_specs"
              },
              "project":{
                "componentInputParameter":"project"
              },
              "base_output_directory":{
                "componentInputParameter":"base_output_directory"
              },
              "reserved_ip_ranges":{
                "componentInputParameter":"reserved_ip_ranges"
              },
              "encryption_spec_key_name":{
                "componentInputParameter":"encryption_spec_key_name"
              },
              "input_text":{
                "componentInputParameter":"input_text"
              },
              "enable_web_access":{
                "componentInputParameter":"enable_web_access"
              }
            }
          },
          "cachingOptions":{
            "enableCache":true
          },
          "componentRef":{
            "name":"comp-custom-training-job"
          }
        }
      }
    }
  }
}