{
    "pipelineSpec":{
       "components":{
          "comp-model-batch-predict":{
             "executorLabel":"exec-model-batch-predict",
             "inputDefinitions":{
                "artifacts":{
                   "model":{
                      "artifactType":{
                         "schemaTitle":"google.VertexModel",
                         "schemaVersion":"0.0.1"
                      }
                   }
                },
                "parameters":{
                   "accelerator_count":{
                      "type":"INT"
                   },
                   "accelerator_type":{
                      "type":"STRING"
                   },
                   "bigquery_destination_output_uri":{
                      "type":"STRING"
                   },
                   "bigquery_source_input_uri":{
                      "type":"STRING"
                   },
                   "encryption_spec_key_name":{
                      "type":"STRING"
                   },
                   "explanation_metadata":{
                      "type":"STRING"
                   },
                   "explanation_parameters":{
                      "type":"STRING"
                   },
                   "gcs_destination_output_uri_prefix":{
                      "type":"STRING"
                   },
                   "gcs_source_uris":{
                      "type":"STRING"
                   },
                   "generate_explanation":{
                      "type":"STRING"
                   },
                   "instances_format":{
                      "type":"STRING"
                   },
                   "job_display_name":{
                      "type":"STRING"
                   },
                   "labels":{
                      "type":"STRING"
                   },
                   "location":{
                      "type":"STRING"
                   },
                   "machine_type":{
                      "type":"STRING"
                   },
                   "manual_batch_tuning_parameters_batch_size":{
                      "type":"INT"
                   },
                   "max_replica_count":{
                      "type":"INT"
                   },
                   "model_parameters":{
                      "type":"STRING"
                   },
                   "predictions_format":{
                      "type":"STRING"
                   },
                   "project":{
                      "type":"STRING"
                   },
                   "starting_replica_count":{
                      "type":"INT"
                   }
                }
             },
             "outputDefinitions":{
                "artifacts":{
                   "batchpredictionjob":{
                      "artifactType":{
                         "schemaTitle":"google.VertexBatchPredictionJob",
                         "schemaVersion":"0.0.1"
                      }
                   }
                },
                "parameters":{
                   "gcp_resources":{
                      "type":"STRING"
                   }
                }
             }
          },
          "comp-model-upload":{
             "executorLabel":"exec-model-upload",
             "inputDefinitions":{
                "parameters":{
                   "artifact_uri":{
                      "type":"STRING"
                   },
                   "display_name":{
                      "type":"STRING"
                   },
                   "explanation_metadata":{
                      "type":"STRING"
                   },
                   "explanation_parameters":{
                      "type":"STRING"
                   },
                   "labels":{
                      "type":"STRING"
                   },
                   "location":{
                      "type":"STRING"
                   },
                   "project":{
                      "type":"STRING"
                   },
                   "serving_container_args":{
                      "type":"STRING"
                   },
                   "serving_container_command":{
                      "type":"STRING"
                   },
                   "serving_container_environment_variables":{
                      "type":"STRING"
                   },
                   "serving_container_image_uri":{
                      "type":"STRING"
                   },
                   "serving_container_ports":{
                      "type":"STRING"
                   }
                }
             },
             "outputDefinitions":{
                "artifacts":{
                   "model":{
                      "artifactType":{
                         "schemaTitle":"google.VertexModel",
                         "schemaVersion":"0.0.1"
                      }
                   }
                },
                "parameters":{
                   "gcp_resources":{
                      "type":"STRING"
                   }
                }
             }
          }
       },
       "deploymentSpec":{
          "executors":{
             "exec-model-batch-predict":{
                "container":{
                   "args":[
                      "--type",
                      "BatchPredictionJob",
                      "--payload",
                      "{\"display_name\": \"{{$.inputs.parameters['job_display_name']}}\", \"model\": \"{{$.inputs.artifacts['model'].metadata['resourceName']}}\", \"input_config\": {\"instances_format\": \"{{$.inputs.parameters['instances_format']}}\", \"gcs_source\": {\"uris\":{{$.inputs.parameters['gcs_source_uris']}}}, \"bigquery_source\": {\"input_uri\": \"{{$.inputs.parameters['bigquery_source_input_uri']}}\"}}, \"model_parameters\": {{$.inputs.parameters['model_parameters']}}, \"output_config\": {\"predictions_format\": \"{{$.inputs.parameters['predictions_format']}}\", \"gcs_destination\": {\"output_uri_prefix\": \"{{$.inputs.parameters['gcs_destination_output_uri_prefix']}}\"}, \"bigquery_destination\": {\"output_uri\": \"{{$.inputs.parameters['bigquery_destination_output_uri']}}\"}}, \"dedicated_resources\": {\"machine_spec\": {\"machine_type\": \"{{$.inputs.parameters['machine_type']}}\", \"accelerator_type\": \"{{$.inputs.parameters['accelerator_type']}}\", \"accelerator_count\": {{$.inputs.parameters['accelerator_count']}}}, \"starting_replica_count\": {{$.inputs.parameters['starting_replica_count']}}, \"max_replica_count\": {{$.inputs.parameters['max_replica_count']}}}, \"manual_batch_tuning_parameters\": {\"batch_size\": {{$.inputs.parameters['manual_batch_tuning_parameters_batch_size']}}}, \"generate_explanation\": \"{{$.inputs.parameters['generate_explanation']}}\", \"explanation_spec\": {\"parameters\": {{$.inputs.parameters['explanation_parameters']}}, \"metadata\": {{$.inputs.parameters['explanation_metadata']}}}, \"labels\": {{$.inputs.parameters['labels']}}, \"encryption_spec\": {\"kms_key_name\":\"{{$.inputs.parameters['encryption_spec_key_name']}}\"}}",
                      "--project",
                      "{{$.inputs.parameters['project']}}",
                      "--location",
                      "{{$.inputs.parameters['location']}}",
                      "--gcp_resources",
                      "{{$.outputs.parameters['gcp_resources'].output_file}}",
                      "--executor_input",
                      "{{$}}"
                   ],
                   "command":[
                      "python3",
                      "-u",
                      "-m",
                      "google_cloud_pipeline_components.container.experimental.gcp_launcher.launcher"
                   ],
                   "image":"gcr.io/ml-pipeline/google-cloud-pipeline-components:latest"
                }
             },
             "exec-model-upload":{
                "container":{
                   "args":[
                      "--type",
                      "UploadModel",
                      "--payload",
                      "{\"display_name\": \"{{$.inputs.parameters['display_name']}}\", \"description\": \"\", \"predict_schemata\": {\"instance_schema_uri\": \"\", \"parameters_schema_uri\": \"\", \"prediction_schema_uri\": \"\"}, \"container_spec\": {\"image_uri\": \"{{$.inputs.parameters['serving_container_image_uri']}}\", \"command\": {{$.inputs.parameters['serving_container_command']}}, \"args\": {{$.inputs.parameters['serving_container_args']}}, \"env\": {{$.inputs.parameters['serving_container_environment_variables']}}, \"ports\": {{$.inputs.parameters['serving_container_ports']}}, \"predict_route\": \"\", \"health_route\": \"\"}, \"artifact_uri\": \"{{$.inputs.parameters['artifact_uri']}}\", \"explanation_spec\": {\"parameters\": {{$.inputs.parameters['explanation_parameters']}}, \"metadata\": {{$.inputs.parameters['explanation_metadata']}}}, \"encryption_spec\": {\"kms_key_name\":\"\"}, \"labels\": {{$.inputs.parameters['labels']}}}",
                      "--project",
                      "{{$.inputs.parameters['project']}}",
                      "--location",
                      "{{$.inputs.parameters['location']}}",
                      "--gcp_resources",
                      "{{$.outputs.parameters['gcp_resources'].output_file}}",
                      "--executor_input",
                      "{{$}}"
                   ],
                   "command":[
                      "python3",
                      "-u",
                      "-m",
                      "google_cloud_pipeline_components.container.experimental.gcp_launcher.launcher"
                   ],
                   "image":"gcr.io/ml-pipeline/google-cloud-pipeline-components:latest"
                }
             }
          }
       },
       "pipelineInfo":{
          "name":"training-test"
       },
       "root":{
          "dag":{
             "tasks":{
                "model-batch-predict":{
                   "cachingOptions":{
                      "enableCache":true
                   },
                   "componentRef":{
                      "name":"comp-model-batch-predict"
                   },
                   "dependentTasks":[
                      "model-upload"
                   ],
                   "inputs":{
                      "artifacts":{
                         "model":{
                            "taskOutputArtifact":{
                               "outputArtifactKey":"model",
                               "producerTask":"model-upload"
                            }
                         }
                      },
                      "parameters":{
                         "accelerator_count":{
                            "runtimeValue":{
                               "constantValue":{
                                  "intValue":"1"
                               }
                            }
                         },
                         "accelerator_type":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"accelerator_type"
                               }
                            }
                         },
                         "bigquery_destination_output_uri":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"bigquery_destination_output_uri"
                               }
                            }
                         },
                         "bigquery_source_input_uri":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"bigquery_source_input_uri"
                               }
                            }
                         },
                         "encryption_spec_key_name":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"some encryption_spec_key_name"
                               }
                            }
                         },
                         "explanation_metadata":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"{\"xai_m\":\"bar\"}"
                               }
                            }
                         },
                         "explanation_parameters":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"{\"xai_p\":\"foo\"}"
                               }
                            }
                         },
                         "gcs_destination_output_uri_prefix":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"gs://test_gcs_output_dir/batch_prediction"
                               }
                            }
                         },
                         "gcs_source_uris":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"[\"gs://test_gcs_source\"]"
                               }
                            }
                         },
                         "generate_explanation":{
                            "runtimeValue":{
                               "constantValue":{
                                  "intValue":"1"
                               }
                            }
                         },
                         "instances_format":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"instance_format"
                               }
                            }
                         },
                         "job_display_name":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"test_display_name"
                               }
                            }
                         },
                         "labels":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"{\"foo\": \"bar\"}"
                               }
                            }
                         },
                         "location":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"us-central1"
                               }
                            }
                         },
                         "machine_type":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"machine_type"
                               }
                            }
                         },
                         "manual_batch_tuning_parameters_batch_size":{
                            "runtimeValue":{
                               "constantValue":{
                                  "intValue":"4"
                               }
                            }
                         },
                         "max_replica_count":{
                            "runtimeValue":{
                               "constantValue":{
                                  "intValue":"3"
                               }
                            }
                         },
                         "model_parameters":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"{\"foo\":\"bar\"}"
                               }
                            }
                         },
                         "predictions_format":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"predictions_format"
                               }
                            }
                         },
                         "project":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"test_project"
                               }
                            }
                         },
                         "starting_replica_count":{
                            "runtimeValue":{
                               "constantValue":{
                                  "intValue":"2"
                               }
                            }
                         }
                      }
                   },
                   "taskInfo":{
                      "name":"model-batch-predict"
                   }
                },
                "model-upload":{
                   "cachingOptions":{
                      "enableCache":true
                   },
                   "componentRef":{
                      "name":"comp-model-upload"
                   },
                   "inputs":{
                      "parameters":{
                         "artifact_uri":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"project/test_artifact_uri"
                               }
                            }
                         },
                         "display_name":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"test_display_name"
                               }
                            }
                         },
                         "explanation_metadata":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"{}"
                               }
                            }
                         },
                         "explanation_parameters":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"{}"
                               }
                            }
                         },
                         "labels":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"{}"
                               }
                            }
                         },
                         "location":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"us-central1"
                               }
                            }
                         },
                         "project":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"test_project"
                               }
                            }
                         },
                         "serving_container_args":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"{}"
                               }
                            }
                         },
                         "serving_container_command":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"{}"
                               }
                            }
                         },
                         "serving_container_environment_variables":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"{}"
                               }
                            }
                         },
                         "serving_container_image_uri":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"gcr.io/test_project/test_image:test_tag"
                               }
                            }
                         },
                         "serving_container_ports":{
                            "runtimeValue":{
                               "constantValue":{
                                  "stringValue":"{}"
                               }
                            }
                         }
                      }
                   },
                   "taskInfo":{
                      "name":"model-upload"
                   }
                }
             }
          }
       },
       "schemaVersion":"2.0.0"
    },
    "runtimeConfig":{}
 }
